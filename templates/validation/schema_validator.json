{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SQLOnt Database Schema Specification",
  "description": "JSON Schema for validating SQLOnt database schema YAML files",
  "type": "object",
  "required": ["database", "tables"],
  "properties": {
    "database": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Database name"
        },
        "type": {
          "type": "string",
          "enum": ["PostgreSQL", "MySQL", "SQLite", "Oracle", "SQL Server", "MariaDB"],
          "description": "Database engine type"
        },
        "version": {
          "type": "string",
          "description": "Database engine version"
        },
        "connection": {
          "type": "object",
          "properties": {
            "host": {"type": "string"},
            "port": {"type": "integer", "minimum": 1, "maximum": 65535},
            "database": {"type": "string"},
            "schema": {"type": "string"}
          }
        },
        "description": {"type": "string"},
        "environment": {
          "type": "string",
          "enum": ["development", "staging", "production", "test"]
        },
        "created": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "modified": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "maintainer": {
          "type": "object",
          "properties": {
            "name": {"type": "string"},
            "email": {"type": "string", "format": "email"}
          }
        },
        "migration": {
          "type": "object",
          "properties": {
            "tool": {"type": "string"},
            "version": {"type": "string"},
            "location": {"type": "string"}
          }
        }
      }
    },
    "settings": {
      "type": "object",
      "properties": {
        "naming_convention": {
          "type": "object",
          "properties": {
            "tables": {"type": "string"},
            "columns": {"type": "string"},
            "indexes": {"type": "string"},
            "constraints": {"type": "string"}
          }
        },
        "defaults": {
          "type": "object",
          "properties": {
            "charset": {"type": "string"},
            "collation": {"type": "string"},
            "engine": {"type": "string"}
          }
        },
        "audit_fields": {
          "type": "object"
        }
      }
    },
    "tables": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "fields"],
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Table name"
          },
          "description": {"type": "string"},
          "ontology_mapping": {
            "type": "object",
            "properties": {
              "class": {"type": "string"},
              "uri": {"type": "string", "format": "uri"},
              "property": {"type": "string"}
            }
          },
          "options": {
            "type": "object",
            "properties": {
              "temporal": {"type": "boolean"},
              "partitioned": {"type": "boolean"},
              "partition_key": {"type": "string"}
            }
          },
          "fields": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["name", "type"],
              "properties": {
                "name": {
                  "type": "string",
                  "pattern": "^[a-z][a-z0-9_]*$"
                },
                "type": {
                  "type": "string",
                  "pattern": "^[A-Z][A-Z0-9_()]+"
                },
                "nullable": {"type": "boolean"},
                "unique": {"type": "boolean"},
                "primary_key": {"type": "boolean"},
                "auto_increment": {"type": "boolean"},
                "default": {},
                "description": {"type": "string"},
                "business_name": {"type": "string"},
                "ontology_mapping": {
                  "type": "object",
                  "properties": {
                    "property": {"type": "string"},
                    "uri": {"type": "string", "format": "uri"}
                  }
                },
                "validation": {
                  "type": "object",
                  "properties": {
                    "pattern": {"type": "string"},
                    "min_length": {"type": "integer", "minimum": 0},
                    "max_length": {"type": "integer", "minimum": 1},
                    "min_value": {"type": "number"},
                    "max_value": {"type": "number"},
                    "enum": {
                      "type": "array",
                      "items": {"type": "string"}
                    }
                  }
                },
                "classification": {
                  "type": "object",
                  "properties": {
                    "sensitivity": {
                      "type": "string",
                      "enum": ["PUBLIC", "INTERNAL", "CONFIDENTIAL", "RESTRICTED"]
                    },
                    "pii": {"type": "boolean"},
                    "phi": {"type": "boolean"}
                  }
                },
                "source": {
                  "type": "object",
                  "properties": {
                    "system": {"type": "string"},
                    "table": {"type": "string"},
                    "column": {"type": "string"},
                    "transformation": {"type": "string"}
                  }
                }
              }
            }
          },
          "indexes": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "columns"],
              "properties": {
                "name": {"type": "string"},
                "columns": {
                  "type": "array",
                  "minItems": 1,
                  "items": {"type": "string"}
                },
                "unique": {"type": "boolean"},
                "type": {
                  "type": "string",
                  "enum": ["BTREE", "HASH", "FULLTEXT", "SPATIAL"]
                },
                "description": {"type": "string"}
              }
            }
          },
          "constraints": {
            "type": "object",
            "properties": {
              "foreign_keys": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["name", "columns", "references"],
                  "properties": {
                    "name": {"type": "string"},
                    "columns": {
                      "type": "array",
                      "minItems": 1,
                      "items": {"type": "string"}
                    },
                    "references": {
                      "type": "object",
                      "required": ["table", "columns"],
                      "properties": {
                        "table": {"type": "string"},
                        "columns": {
                          "type": "array",
                          "minItems": 1,
                          "items": {"type": "string"}
                        }
                      }
                    },
                    "on_delete": {
                      "type": "string",
                      "enum": ["CASCADE", "RESTRICT", "SET NULL", "NO ACTION"]
                    },
                    "on_update": {
                      "type": "string",
                      "enum": ["CASCADE", "RESTRICT", "SET NULL", "NO ACTION"]
                    }
                  }
                }
              },
              "checks": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["name", "condition"],
                  "properties": {
                    "name": {"type": "string"},
                    "condition": {"type": "string"},
                    "description": {"type": "string"}
                  }
                }
              },
              "uniques": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["name", "columns"],
                  "properties": {
                    "name": {"type": "string"},
                    "columns": {
                      "type": "array",
                      "minItems": 1,
                      "items": {"type": "string"}
                    }
                  }
                }
              }
            }
          },
          "triggers": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {"type": "string"},
                "timing": {
                  "type": "string",
                  "enum": ["BEFORE", "AFTER"]
                },
                "event": {
                  "type": "string",
                  "enum": ["INSERT", "UPDATE", "DELETE"]
                },
                "body": {"type": "string"}
              }
            }
          }
        }
      }
    },
    "views": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "definition"],
        "properties": {
          "name": {"type": "string"},
          "description": {"type": "string"},
          "ontology_mapping": {
            "type": "object",
            "properties": {
              "implements": {"type": "string"}
            }
          },
          "definition": {"type": "string"},
          "materialized": {"type": "boolean"},
          "refresh_interval": {"type": "string"}
        }
      }
    },
    "relationships": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "type", "from", "to"],
        "properties": {
          "name": {"type": "string"},
          "type": {
            "type": "string",
            "enum": ["one-to-one", "one-to-many", "many-to-many"]
          },
          "from": {
            "type": "object",
            "required": ["table", "columns"],
            "properties": {
              "table": {"type": "string"},
              "columns": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          },
          "to": {
            "type": "object",
            "required": ["table", "columns"],
            "properties": {
              "table": {"type": "string"},
              "columns": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          },
          "through": {
            "type": "object",
            "properties": {
              "table": {"type": "string"}
            }
          },
          "description": {"type": "string"},
          "ontology_mapping": {
            "type": "object",
            "properties": {
              "property": {"type": "string"},
              "uri": {"type": "string", "format": "uri"}
            }
          }
        }
      }
    },
    "data_quality": {
      "type": "object",
      "properties": {
        "rules": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "type": {
                "type": "string",
                "enum": ["completeness", "accuracy", "consistency", "timeliness", "uniqueness", "referential_integrity"]
              },
              "table": {"type": "string"},
              "tables": {
                "type": "array",
                "items": {"type": "string"}
              },
              "columns": {
                "type": "array",
                "items": {"type": "string"}
              },
              "condition": {"type": "string"},
              "severity": {
                "type": "string",
                "enum": ["ERROR", "WARNING", "INFO"]
              },
              "description": {"type": "string"}
            }
          }
        }
      }
    },
    "sample_data": {
      "type": "object"
    },
    "api_integration": {
      "type": "object"
    },
    "performance": {
      "type": "object"
    },
    "documentation": {
      "type": "object"
    }
  }
}